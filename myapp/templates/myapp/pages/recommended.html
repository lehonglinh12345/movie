{% load static %}
<style>
  :root {
    --primary-color: #7c3aed;
    --secondary-color: #0f172a;
    --accent-color: #f43f5e;
    --text-color: #f1f5f9;
    --overlay-opacity: 0.9;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    --border-radius: 8px;
    --transition: all 0.3s ease;
    --rating-color: #facc15; /* Màu cho phần đánh giá */
  }

  .suggestion-section {
    margin: 8px 0;
    background: linear-gradient(135deg, var(--secondary-color), #2a2a4e);
    padding: 8px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    animation: fadeIn 0.6s ease-out;
  }

  .suggestion-title {
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--text-color);
    margin-bottom: 10px;
    font-family: 'Montserrat', sans-serif;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .suggestion-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 10px;
  }

  .suggestion-card {
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
    background: var(--secondary-color);
  }

  .suggestion-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(250, 204, 21, 0.15);
  }

  .suggestion-thumbnail {
    position: relative;
    aspect-ratio: 1 / 1;
    overflow: hidden;
  }

  .suggestion-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease, opacity 0.4s ease;
  }

  .suggestion-thumbnail:hover img {
    transform: scale(1.05);
    opacity: 0.4;
  }

  .video-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, var(--overlay-opacity));
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 10;
  }

  .suggestion-thumbnail:hover .video-overlay {
    opacity: 1;
  }

  .suggestion-info {
    padding: 8px;
    color: var(--text-color);
    font-family: 'Inter', sans-serif;
  }

  .suggestion-info h4 {
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .suggestion-info p {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-bottom: 3px;
    line-height: 1.2;
  }

  .suggestion-info p.rating {
    color: var(--rating-color);
    font-weight: 600;
  }

  .suggestion-info p.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (max-width: 768px) {
    .suggestion-grid {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
    }

    .suggestion-thumbnail {
      height: 100px;
    }

    .suggestion-info h4 {
      font-size: 0.9rem;
    }

    .suggestion-info p {
      font-size: 0.7rem;
    }
  }

  @media (max-width: 480px) {
    .suggestion-grid {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    }

    .suggestion-thumbnail {
      height: 90px;
    }
  }
</style>

{% if recommended_movies %}
<div class="suggestion-section">
  <h2 class="suggestion-title">Phim Tương Tự </h2>
  <div class="suggestion-grid">
    {% for movie in recommended_movies %}
    <a href="{% url 'chitietphim' maphim=movie.maphim %}" class="suggestion-card">
      <div class="suggestion-thumbnail">
        <img src="{% if movie.anh_bia %}{{ movie.anh_bia.url }}{% else %}{% static 'myapp/img/logo.jpg' %}{% endif %}" 
             alt="{{ movie.ten_phim }}" 
             loading="lazy">
        {% if movie.video_url %}
        <div class="video-overlay">
          <iframe loading="lazy" 
                  width="100%" 
                  height="100%" 
                  class="rounded" 
                  src="https://www.youtube.com/embed/{{ movie.video_url|slice:'17:' }}" 
                  frameborder="0" 
                  allowfullscreen
                  title="{{ movie.ten_phim }} trailer">
          </iframe>
        </div>
        {% endif %}
      </div>
      <div class="suggestion-info">
        <h4>{{ movie.ten_phim }}</h4>
        
     <p class="rating">
  Đánh giá: 
  {% if movie.avg_score %}
    ⭐ {{ movie.avg_score|floatformat:1 }}/5
  {% else %}
    ⭐ Chưa có đánh giá
  {% endif %}
</p>
       <p>Thể loại: 
          {% for tl in movie.the_loai.all %}
            {{ tl.ten }}{% if not forloop.last %}, {% endif %}
          {% empty %}
            Không có thể loại
          {% endfor %}
        </p>

        <p class="line-clamp-2">Đạo Diễn : {{ movie.dao_dien|truncatechars:40 }}</p>
        <p>Diễn Viên: 
          {% for dv in movie.dien_vien.all %}
            {{ dv.ten|truncatechars:30 }}{% if not forloop.last %}, {% endif %}
          {% empty %}
            Không có diễn viên
          {% endfor %}
      
 
        
        </div>
    </a>
    {% endfor %}
  </div>
</div>
{% endif %}